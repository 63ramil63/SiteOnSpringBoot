<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" th:href="@{/styles/mainStyle.css}">
</head>
<body>
    <div class="header">
        <div class="headerL">
            <div class="box">Сайт</div>
            <div class="box"><a href="market">Главная</a></div>
        </div>
        <div class="headerR">
            <div class="box" th:if="${isAdmin}"><a href="/adminPanel">Admin Panel</a></div>
            <div class="box" th:if="${isAuth}"><a href="/orders">Корзина</a></div>
            <div class="box" th:if="${isAuth}"><a th:text="${cache} + 'р.'" href="/balance"></a></div>
            <div class="box" th:text="${username}"></div>
            <div class="box" th:if="${!isAuth}"><a href="/login">Войти</a></div>
            <div class="box" th:if="${isAuth}">
                <form method="post" th:action="@{/logout}">
                    <input type="submit" value="Выйти">
                </form>
            </div>
        </div>
    </div>
    <div class="mainContainer">
        <div class="sideMenu" id="firstSideMenu">
            <div>
                <form name="types" method="get" th:action="@{/market}">
                    <a>Тип продукта</a>
                    <div th:each="type: ${types}">
                        <label>
                            <!-- проверяем передаваемый список и ищем совпадения в списке и устанавливаем checked-->
                            <input type="checkbox" name="type" th:value="${type}"
                                   th:checked="${#lists.contains(selectedTypes, type)}"
                                   onclick="this.form.submit()">
                            <span th:text="${type}"></span>
                        </label>
                    </div>
                    <a>Производитель</a>
                    <div th:each="companyName: ${companyNames}">
                        <label>
                            <!-- проверяем передаваемый список и ищем совпадения в списке и устанавливаем checked-->
                            <input type="checkbox" name="companyName" th:value="${companyName}"
                                   th:checked="${#lists.contains(selectedCompanyNames, companyName)}"
                                   onclick="this.form.submit()">
                            <span th:text="${companyName}"></span>
                        </label>
                    </div>
                </form>
            </div>
        </div>
        <div class="sideMenu" id="secondSideMenu">
            <div id="sortDiv">
                <select id="sortSelect">
                    <option value="" th:selected="${selectedSort == null}">По умолчанию</option>
                    <option value="byPriceAsc" th:selected="${selectedSort == 'byPriceAsc'}">По возрастанию</option>
                    <option value="byPriceDesc" th:selected="${selectedSort == 'byPriceDesc'}">По убыванию</option>
                </select>
            </div>
            <div id="cardContainer">
                <div class="card" th:each="product: ${products}">
                    <div class="imgContainer">
                        <img th:src="${product.imgSrc}" id="image">
                    </div>
                    <div class="info">
                        <div class="textInfo">
                            <a th:text="${product.name}" th:href="@{/productPage(productId=${product.id})}"></a>
                        </div>
                        <div class="cardBottom">
                            <div>
                                <a th:text="${product.price}"></a>
                            </div>
                            <div>
                                <form name="orderProduct" method="post" th:action="@{/order}">
                                    <input type="hidden" name="productId" th:value="${product.Id}">
                                    <input type="submit" value="buy">
                                </form>
                            </div>
                        </div>
                        <div th:if="${isAdmin}">
                            <a th:href="@{'/api/productFeature?id=' + ${product.id}}">product info</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div id="notification" style="
      display: none;
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background-color: rgba(0, 128, 0, 0.6);
      color: white;
      padding: 10px 20px;
      border-radius: 5px;
      z-index: 1000;">
        Товар добавлен в корзину!
    </div>
    <script>
        window.onload = function() {
          const urlParams = new URLSearchParams(window.location.search);
          if (urlParams.get('added') === 'true') {
            const notification = document.getElementById('notification');
            notification.style.display = 'block';
            setTimeout(() => {
              notification.style.display = 'none';
            }, 5000);
          }
        }
        document.getElementById('sortSelect').addEventListener('change', function() {
            const selectedValue = this.value;
            const url = new URL(window.location.href);
            if (selectedValue) {
                url.searchParams.set('sort', selectedValue);
            } else {
                url.searchParams.delete('sort');
            }
            window.location.href = url.toString();
        });
    </script>
</body>
</html>